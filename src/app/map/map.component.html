<div class="container">
  <!-- Header -->
  <div class="header">
    <div class="logo">üó∫Ô∏è Mapa de Den√∫ncias</div>
    <div class="user-info">
      <span>Usu√°rio: {{ userName }}</span>
      <button class="btn btn-secondary" (click)="logout()">Sair</button>
    </div>
  </div>

  <!-- Instru√ß√µes -->
  <div class="map-instructions">
    <strong>üìç Clique no mapa para registrar uma nova den√∫ncia</strong>
  </div>

  <!-- Container do Mapa -->
  <div class="map-container">
    <div class="map" #mapElement (click)="onMapClick($event)">
      <!-- Marcadores das den√∫ncias -->
      <div
        *ngFor="let complaint of complaints"
        class="map-marker"
        [style.top.%]="complaint.lat"
        [style.left.%]="complaint.lng"
        (click)="showComplaintDetails($event, complaint)"
        [title]="complaint.title"
      ></div>
    </div>
  </div>
</div>

<!-- Popup para nova den√∫ncia -->
<div
  class="popup-overlay"
  [class.show]="showNewComplaintPopup"
  (click)="closePopupIfOutside($event)"
>
  <div class="popup">
    <button class="close-btn" (click)="closeNewComplaintPopup()">
      &times;
    </button>
    <h3>Nova Den√∫ncia</h3>
    <form (ngSubmit)="submitComplaint()" #complaintForm="ngForm">
      <div class="form-group">
        <label>Tipo de Den√∫ncia:</label>
        <select [(ngModel)]="newComplaint.type" name="type" required>
          <option value="">Selecione...</option>
          <option value="infraestrutura">Infraestrutura</option>
          <option value="limpeza">Limpeza Urbana</option>
          <option value="iluminacao">Ilumina√ß√£o P√∫blica</option>
          <option value="transito">Tr√¢nsito</option>
          <option value="outros">Outros</option>
        </select>
      </div>

      <div class="form-group">
        <label>T√≠tulo:</label>
        <input
          type="text"
          [(ngModel)]="newComplaint.title"
          name="title"
          placeholder="T√≠tulo da den√∫ncia"
          required
        />
      </div>

      <div class="form-group">
        <label>Descri√ß√£o:</label>
        <textarea
          [(ngModel)]="newComplaint.description"
          name="description"
          rows="4"
          placeholder="Descreva o problema detalhadamente..."
          required
        >
        </textarea>
      </div>

      <div class="form-group">
        <label>Urg√™ncia:</label>
        <select [(ngModel)]="newComplaint.urgency" name="urgency">
          <option value="baixa">Baixa</option>
          <option value="media">M√©dia</option>
          <option value="alta">Alta</option>
        </select>
      </div>

      <div class="form-buttons">
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="!complaintForm.valid"
        >
          Registrar Den√∫ncia
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeNewComplaintPopup()"
        >
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Popup para detalhes da den√∫ncia -->
<div
  class="popup-overlay"
  [class.show]="showDetailsPopup"
  (click)="closePopupIfOutside($event)"
>
  <div class="popup">
    <button class="close-btn" (click)="closeDetailsPopup()">&times;</button>
    <h3>{{ selectedComplaint?.title }}</h3>
    <div *ngIf="selectedComplaint" class="complaint-details">
      <p>
        <strong>Tipo:</strong>
        {{ getComplaintTypeLabel(selectedComplaint.type) }}
      </p>
      <p><strong>Data:</strong> {{ selectedComplaint.date }}</p>
      <p>
        <strong>Status:</strong>
        <span
          [class]="
            'status-badge status-' +
            selectedComplaint.status.toLowerCase().replace(' ', '')
          "
        >
          {{ selectedComplaint.status }}
        </span>
      </p>
      <p><strong>Urg√™ncia:</strong> {{ selectedComplaint.urgency }}</p>
      <p><strong>Descri√ß√£o:</strong></p>
      <div class="description-box">
        {{ selectedComplaint.description }}
      </div>
    </div>
  </div>
</div>
